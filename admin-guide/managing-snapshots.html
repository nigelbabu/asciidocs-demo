<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Gluster User Documentation Latest | Gluster Docs Project | Managing snapshots</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href="../../latest/_stylesheets/asciibinder.css" rel="stylesheet" />

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="../../latest/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="../../latest/_images/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body>
  <div class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="http://www.asciibinder.org/"><img alt="AsciiBinder" src="../../latest/_images/asciibinder-logo-horizontal.png"></a>
      </div>
    </div>
  </div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Home</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster User Documentation Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster Docs Project</a>
      </li>
      
      <li class="hidden-xs active">
        Managing snapshots
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-down"></span>Gluster Docs Project
      </a>
      <ul id="topicGroup0" class="collapse in list-unstyled">
            <li><a class="" href="../admin-guide/index.html">Index</a></li>
            <li><a class="" href="../admin-guide/access-control-lists.html">Access Control Lists</a></li>
            <li><a class="" href="../admin-guide/accessing-gluster-from-windows.html">Accessing Gluster from Windows</a></li>
            <li><a class="" href="../admin-guide/arbiter-volumes-and-quorum.html">Arbiter-volumes and Quorum</a></li>
            <li><a class="" href="../admin-guide/bareos.html">BareOS</a></li>
            <li><a class="" href="../admin-guide/brick-naming-conventions.html">Brick naming conventions</a></li>
            <li><a class="" href="../admin-guide/building-qemu-with-gfapi-for-debian-based-systems.html">Building QEMU with gfapi for Debian-based systems</a></li>
            <li><a class="" href="../admin-guide/cinder.html">Cinder</a></li>
            <li><a class="" href="../admin-guide/Console.html">Console</a></li>
            <li><a class="" href="../admin-guide/compiling-rpms.html">Compiling RPMs</a></li>
            <li><a class="" href="../admin-guide/coreutils.html">Coreutils</a></li>
            <li><a class="" href="../admin-guide/did-you-know.html">Did you know</a></li>
            <li><a class="" href="../admin-guide/directory-quota.html">Diectory Quota</a></li>
            <li><a class="" href="../admin-guide/distributed-geo-replication.html">Distributed Geo Replication</a></li>
            <li><a class="" href="../admin-guide/export-and-netgroup-authentication.html">Export and netgroup authentication</a></li>
            <li><a class="" href="../admin-guide/filter.html">Filter</a></li>
            <li><a class="" href="../admin-guide/geo-replication.html">Geo Replication</a></li>
            <li><a class="" href="../admin-guide/glossary.html">Glossary</a></li>
            <li><a class="" href="../admin-guide/gluster-on-zfs.html">Gluster on ZFS</a></li>
            <li><a class="" href="../admin-guide/Hadoop.html">Hadoop</a></li>
            <li><a class="" href="../admin-guide/Handling-of-users-with-many-groups.html">Handling of users with many groups</a></li>
            <li><a class="" href="../admin-guide/introduction.html">Introduction</a></li>
            <li><a class="" href="../admin-guide/iscsi.html">iSCSI</a></li>
            <li><a class="" href="../admin-guide/keystore-quickstart.html">Keystore Quickstart</a></li>
            <li><a class="" href="../admin-guide/linux-kernel-tuning.html">Linux Kernel Tuning</a></li>
            <li><a class="" href="../admin-guide/logging.html">Logging</a></li>
            <li><a class=" active" href="../admin-guide/managing-snapshots.html">Managing snapshots</a></li>
            <li><a class="" href="../admin-guide/managing-volumes.html">Managing Volumes</a></li>
            <li><a class="" href="../admin-guide/mandatory-locks.html">Mandatory Locks</a></li>
            <li><a class="" href="../admin-guide/monitoring-workload.html">Monitoring Workload</a></li>
            <li><a class="" href="../admin-guide/network-configuration-techniques.html">Network Configuration Techniques</a></li>
            <li><a class="" href="../admin-guide/nfs-ganesha-integration.html">NFS-Ganesha Integration</a></li>
            <li><a class="" href="../admin-guide/object-storage.html">Object storage</a></li>
            <li><a class="" href="../admin-guide/performance-testing.html">Performance Testing</a></li>
            <li><a class="" href="../admin-guide/Puppet.html">Puppet</a></li>
            <li><a class="" href="../admin-guide/rdma-transport.html">RDMA Transport</a></li>
            <li><a class="" href="../admin-guide/resolving-peer-rejected.html">Resolving Peer Rejected</a></li>
            <li><a class="" href="../admin-guide/setting-up-clients.html">Setting up Clients</a></li>
            <li><a class="" href="../admin-guide/setting-up-volumes.html">Setting up volumes</a></li>
            <li><a class="" href="../admin-guide/ssl.html">SSL</a></li>
            <li><a class="" href="../admin-guide/start-stop-daemon.html">Start Stop Daemon</a></li>
            <li><a class="" href="../admin-guide/storage-pools.html">Storage Pools</a></li>
            <li><a class="" href="../admin-guide/trash.html">Trash</a></li>
            <li><a class="" href="../admin-guide/troubleshooting.html">Troubleshooting</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Managing GlusterFS Volume Snapshots</h2>
        </div>
        <div class="sect1">
<h2 id="managing-glusterfs-volume-snapshots"><a class="anchor" href="#managing-glusterfs-volume-snapshots"></a>Managing GlusterFS Volume Snapshots</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to perform common GlusterFS volume snapshot
management operations</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pre-requisites"><a class="anchor" href="#pre-requisites"></a>Pre-requisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GlusterFS volume snapshot feature is based on thinly provisioned LVM
snapshot. To make use of snapshot feature GlusterFS volume should
fulfill following pre-requisites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each brick should be on an independent thinly provisioned LVM.</p>
</li>
<li>
<p>Brick LVM should not contain any other data other than brick.</p>
</li>
<li>
<p>None of the brick should be on a thick LVM.</p>
</li>
<li>
<p>gluster version should be 3.6 and above.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Details of how to create thin volume can be found at the following link.
<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Logical_Volume_Manager_Administration/thinly_provisioned_volume_creation.html" class="bare">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Logical_Volume_Manager_Administration/thinly_provisioned_volume_creation.html</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="few-features-of-snapshot-are"><a class="anchor" href="#few-features-of-snapshot-are"></a>Few features of snapshot are:</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Crash Consistency</strong></p>
</div>
<div class="paragraph">
<p>when a snapshot is taken at a particular point-in-time, it is made sure
that the taken snapshot is crash consistent. when the taken snapshot is
restored, then the data is identical as it was at the time of taking a
snapshot.</p>
</div>
<div class="paragraph">
<p><strong>Online Snapshot</strong></p>
</div>
<div class="paragraph">
<p>When the snapshot is being taken the file system and its associated data
continue to be available for the clients.</p>
</div>
<div class="paragraph">
<p><strong>Quorum Based</strong></p>
</div>
<div class="paragraph">
<p>The quorum feature ensures that the volume is in good condition while
the bricks are down. Quorum is not met if any bricks are down in a n-way
replication where n &#8656; 2. Quorum is met when m bricks are up, where m &gt;=
(n/2 + 1) where n is odd, and m &gt;= n/2 and first brick is up where n is
even. snapshot creation fails if quorum is not met.</p>
</div>
<div class="paragraph">
<p><strong>Barrier</strong></p>
</div>
<div class="paragraph">
<p>During snapshot creation some of the fops are blocked to guarantee crash
consistency. There is a default time-out of 2 minutes, if snapshot
creation is not complete within that span then fops are unbarried. If
unbarrier happens before the snapshot creation is complete then the
snapshot creation operation fails. This to ensure that the snapshot is
in a consistent state.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="snapshot-management"><a class="anchor" href="#snapshot-management"></a>Snapshot Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Snapshot creation</strong></p>
</div>
<div class="paragraph">
<p>Syntax : <em>gluster snapshot create [no-timestamp] [description ] [force]</em></p>
</div>
<div class="paragraph">
<p>Details : Creates a snapshot of a GlusterFS volume. User can provide a
snap-name and a description to identify the snap. The description cannot
be more than 1024 characters.</p>
</div>
<div class="paragraph">
<p>Snapshot will be created by appending timestamp with user provided snap
name. User can override this behaviour by giving no-timestamp flag.</p>
</div>
<div class="paragraph">
<p>NOTE : To be able to take a snapshot, volume should be present and it
should be in started state.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Snapshot clone</strong></p>
</div>
<div class="paragraph">
<p>Syntax : _gluster snapshot clone _</p>
</div>
<div class="paragraph">
<p>Details : Creates a clone of a snapshot. Upon successful completion, a
new GlusterFS volume will be created from snapshot. The clone will be a
space efficient clone, i.e, the snapshot and the clone will share the
backend disk.</p>
</div>
<div class="paragraph">
<p>NOTE : To be able to take a clone from snapshot, snapshot should be
present and it should be in activated state.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Restoring snaps</strong></p>
</div>
<div class="paragraph">
<p>Syntax : _gluster snapshot restore _</p>
</div>
<div class="paragraph">
<p>Details : Restores an already taken snapshot of a GlusterFS volume.
Snapshot restore is an offline activity therefore if the volume is
online (in started state) then the restore operation will fail.</p>
</div>
<div class="paragraph">
<p>Once the snapshot is restored it will not be available in the list of
snapshots.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Deleting snaps</strong></p>
</div>
<div class="paragraph">
<p>Syntax : <em>gluster snapshot delete (all | | volume )</em></p>
</div>
<div class="paragraph">
<p>Details : If snapname is specified then mentioned snapshot is deleted.
If volname is specified then all snapshots belonging to that particular
volume is deleted. If keyword <em>all</em> is used then all snapshots belonging
to the system is deleted.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Listing of available snaps</strong></p>
</div>
<div class="paragraph">
<p>Syntax: <em>gluster snapshot list [volname]</em></p>
</div>
<div class="paragraph">
<p>Details: Lists all snapshots taken. If volname is provided, then only
the snapshots belonging to that particular volume is listed.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Information of available snaps</strong></p>
</div>
<div class="paragraph">
<p>Syntax: <em>gluster snapshot info [(snapname | volume )]</em></p>
</div>
<div class="paragraph">
<p>Details: This command gives information such as snapshot name, snapshot
UUID, time at which snapshot was created, and it lists down the
snap-volume-name, number of snapshots already taken and number of
snapshots still available for that particular volume, and the state of
the snapshot.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Status of snapshots</strong></p>
</div>
<div class="paragraph">
<p>Syntax: <em>gluster snapshot status [(snapname | volume )]</em></p>
</div>
<div class="paragraph">
<p>Details: This command gives status of the snapshot. The details included
are snapshot brick path, volume group(LVM details), status of the
snapshot bricks, PID of the bricks, data percentage filled for that
particular volume group to which the snapshots belong to, and total size
of the logical volume.</p>
</div>
<div class="paragraph">
<p>If snapname is specified then status of the mentioned snapshot is
displayed. If volname is specified then status of all snapshots
belonging to that volume is displayed. If both snapname and volname is
not specified then status of all the snapshots present in the system are
displayed.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Configuring the snapshot behavior</strong></p>
</div>
<div class="paragraph">
<p>Syntax: <em>snapshot config [volname] ([snap-max-hard-limit ]
[snap-max-soft-limit ]) | ([auto-delete ]) | ([activate-on-create ])</em></p>
</div>
<div class="paragraph">
<p>Details: Displays and sets the snapshot config values.</p>
</div>
<div class="paragraph">
<p>snapshot config without any keywords displays the snapshot config values
of all volumes in the system. If volname is provided, then the snapshot
config values of that volume is displayed.</p>
</div>
<div class="paragraph">
<p>Snapshot config command along with keywords can be used to change the
existing config values. If volname is provided then config value of that
volume is changed, else it will set/change the system limit.</p>
</div>
<div class="paragraph">
<p>snap-max-soft-limit and auto-delete are global options, that will be
inherited by all volumes in the system and cannot be set to individual
volumes.</p>
</div>
<div class="paragraph">
<p>The system limit takes precedence over the volume specific limit.</p>
</div>
<div class="paragraph">
<p>When auto-delete feature is enabled, then upon reaching the soft-limit,
with every successful snapshot creation, the oldest snapshot will be
deleted.</p>
</div>
<div class="paragraph">
<p>When auto-delete feature is disabled, then upon reaching the soft-limit,
the user gets a warning with every successful snapshot creation.</p>
</div>
<div class="paragraph">
<p>Upon reaching the hard-limit, further snapshot creations will not be
allowed.</p>
</div>
<div class="paragraph">
<p>activate-on-create is disabled by default. If you enable
activate-on-create, then further snapshot will be activated during the
time of snapshot creation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>*Activating a snapshot*

Syntax: _gluster snapshot activate _

Details: Activates the mentioned snapshot.

Note : By default the snapshot is activated during snapshot creation.

'''''

*Deactivate a snapshot*

Syntax: _gluster snapshot deactivate _

Details: Deactivates the mentioned snapshot.

'''''

*Accessing the snapshot*

Snapshots can be activated in 2 ways.

1.  Mounting the snapshot:

The snapshot can be accessed via FUSE mount (only fuse). To do that it
has to be mounted first. A snapshot can be mounted via fuse by below
command

_mount -t glusterfs :/snaps// _

i.e. say "host1" is one of the peers. Let "vol" be the volume name and
"my-snap" be the snapshot name. In this case a snapshot can be mounted
via this command

_mount -t glusterfs host1:/snaps/my-snap/vol /mnt/snapshot_

1.  User serviceability:

Apart from the above method of mounting the snapshot, a list of
available snapshots and the contents of each snapshot can be viewed from
any of the mount points accessing the glusterfs volume (either FUSE or
NFS or SMB). For having user serviceable snapshots, it has to be enabled
for a volume first. User serviceability can be enabled for a volume
using the below command.

_gluster volume set features.uss enable_

Once enabled, from any of the directory (including root of the
filesystem) an access point will be created to the snapshot world. The
access point is a hidden directory cding into which will make the user
enter the snapshot world. By default the hidden directory is ".snaps".
Once user serviceability is enabled, one will be able to cd into .snaps
from any directory. Doing "ls" on that directory shows a list of
directories which are nothing but the snapshots present for that volume.
Say if there are 3 snapshots ("snap1", "snap2", "snap3"), then doing ls
in .snaps directory will show those 3 names as the directory entries.
They represent the state of the directory from which .snaps was entered,
at different points in time.

NOTE: The access to the snapshots are read-only.

Also, the name of the hidden directory (or the access point to the
snapshot world) can be changed using the below command.

_gluster volume set snapshot-directory _

1.  Accessing from windows: The glusterfs volumes can be made accessible
by windows via samba. (the glusterfs plugin for samba helps achieve
this, without having to re-export a fuse mounted glusterfs volume). The
snapshots of a glusterfs volume can also be viewed in the windows
explorer.

There are 2 ways: * Give the path of the entry point directory
(\&lt;samba-share&gt;&lt;directory&gt;&lt;entry-point path&gt;) in the run command window
* Go to the samba share via windows explorer. Make hidden files and
folders visible so that in the root of the samba share a folder icon for
the entry point can be seen.

NOTE: From the explorer, snapshot world can be entered via entry point
only from the root of the samba share. If snapshots have to be seen from
subfolders, then the path should be provided in the run command window.

For snapshots to be accessible from windows, below 2 options can be
used. A) The glusterfs plugin for samba should give the option
"snapdir-entry-path" while starting. The option is an indication to
glusterfs, that samba is loading it and the value of the option should
be the path that is being used as the share for windows. Ex: Say, there
is a glusterfs volume and a directory called "export" from the root of
the volume is being used as the samba share, then samba has to load
glusterfs with this option as well.

....
    ret = glfs_set_xlator_option(fs, "*-snapview-client",
                                 "snapdir-entry-path", "/export");
....

The xlator option "snapdir-entry-path" is not exposed via volume set
options, cannot be changed from CLI. Its an option that has to be
provded at the time of mounting glusterfs or when samba loads glusterfs.
B) The accessibility of snapshots via root of the samba share from
windows is configurable. By default it is turned off. It is a volume set
option which can be changed via CLI.

gluster volume set features.show-snapshot-directory "on/off". By default
it is off.

Only when both the above options have been provided (i.e
snapdir-entry-path contains a valid unix path that is exported and
show-snapshot-directory option is set to true), snapshots can accessed
via windows explorer.

If only 1st option (i.e. snapdir-entry-path) is set via samba and 2nd
option (i.e. show-snapshot-directory) is off, then snapshots can be
accessed from windows via the run command window, but not via the
explorer.

'''''</pre>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>