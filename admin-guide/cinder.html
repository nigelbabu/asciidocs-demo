<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Gluster User Documentation Latest | Gluster Docs Project | Cinder</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href="../../latest/_stylesheets/asciibinder.css" rel="stylesheet" />

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="../../latest/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="../../latest/_images/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body>
  <div class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="http://www.asciibinder.org/"><img alt="AsciiBinder" src="../../latest/_images/asciibinder-logo-horizontal.png"></a>
      </div>
    </div>
  </div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Home</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster User Documentation Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster Docs Project</a>
      </li>
      
      <li class="hidden-xs active">
        Cinder
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-down"></span>Gluster Docs Project
      </a>
      <ul id="topicGroup0" class="collapse in list-unstyled">
            <li><a class="" href="../admin-guide/index.html">Index</a></li>
            <li><a class="" href="../admin-guide/access-control-lists.html">Access Control Lists</a></li>
            <li><a class="" href="../admin-guide/accessing-gluster-from-windows.html">Accessing Gluster from Windows</a></li>
            <li><a class="" href="../admin-guide/arbiter-volumes-and-quorum.html">Arbiter-volumes and Quorum</a></li>
            <li><a class="" href="../admin-guide/bareos.html">BareOS</a></li>
            <li><a class="" href="../admin-guide/brick-naming-conventions.html">Brick naming conventions</a></li>
            <li><a class="" href="../admin-guide/building-qemu-with-gfapi-for-debian-based-systems.html">Building QEMU with gfapi for Debian-based systems</a></li>
            <li><a class=" active" href="../admin-guide/cinder.html">Cinder</a></li>
            <li><a class="" href="../admin-guide/Console.html">Console</a></li>
            <li><a class="" href="../admin-guide/compiling-rpms.html">Compiling RPMs</a></li>
            <li><a class="" href="../admin-guide/coreutils.html">Coreutils</a></li>
            <li><a class="" href="../admin-guide/did-you-know.html">Did you know</a></li>
            <li><a class="" href="../admin-guide/directory-quota.html">Diectory Quota</a></li>
            <li><a class="" href="../admin-guide/distributed-geo-replication.html">Distributed Geo Replication</a></li>
            <li><a class="" href="../admin-guide/export-and-netgroup-authentication.html">Export and netgroup authentication</a></li>
            <li><a class="" href="../admin-guide/filter.html">Filter</a></li>
            <li><a class="" href="../admin-guide/geo-replication.html">Geo Replication</a></li>
            <li><a class="" href="../admin-guide/glossary.html">Glossary</a></li>
            <li><a class="" href="../admin-guide/gluster-on-zfs.html">Gluster on ZFS</a></li>
            <li><a class="" href="../admin-guide/Hadoop.html">Hadoop</a></li>
            <li><a class="" href="../admin-guide/Handling-of-users-with-many-groups.html">Handling of users with many groups</a></li>
            <li><a class="" href="../admin-guide/introduction.html">Introduction</a></li>
            <li><a class="" href="../admin-guide/iscsi.html">iSCSI</a></li>
            <li><a class="" href="../admin-guide/keystore-quickstart.html">Keystore Quickstart</a></li>
            <li><a class="" href="../admin-guide/linux-kernel-tuning.html">Linux Kernel Tuning</a></li>
            <li><a class="" href="../admin-guide/logging.html">Logging</a></li>
            <li><a class="" href="../admin-guide/managing-snapshots.html">Managing snapshots</a></li>
            <li><a class="" href="../admin-guide/managing-volumes.html">Managing Volumes</a></li>
            <li><a class="" href="../admin-guide/mandatory-locks.html">Mandatory Locks</a></li>
            <li><a class="" href="../admin-guide/monitoring-workload.html">Monitoring Workload</a></li>
            <li><a class="" href="../admin-guide/network-configuration-techniques.html">Network Configuration Techniques</a></li>
            <li><a class="" href="../admin-guide/nfs-ganesha-integration.html">NFS-Ganesha Integration</a></li>
            <li><a class="" href="../admin-guide/object-storage.html">Object storage</a></li>
            <li><a class="" href="../admin-guide/performance-testing.html">Performance Testing</a></li>
            <li><a class="" href="../admin-guide/Puppet.html">Puppet</a></li>
            <li><a class="" href="../admin-guide/rdma-transport.html">RDMA Transport</a></li>
            <li><a class="" href="../admin-guide/resolving-peer-rejected.html">Resolving Peer Rejected</a></li>
            <li><a class="" href="../admin-guide/setting-up-clients.html">Setting up Clients</a></li>
            <li><a class="" href="../admin-guide/setting-up-volumes.html">Setting up volumes</a></li>
            <li><a class="" href="../admin-guide/ssl.html">SSL</a></li>
            <li><a class="" href="../admin-guide/start-stop-daemon.html">Start Stop Daemon</a></li>
            <li><a class="" href="../admin-guide/storage-pools.html">Storage Pools</a></li>
            <li><a class="" href="../admin-guide/trash.html">Trash</a></li>
            <li><a class="" href="../admin-guide/troubleshooting.html">Troubleshooting</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Accessing GlusterFS using Cinder Hosts</h2>
        </div>
        <div class="sect1">
<h2 id="accessing-glusterfs-using-cinder-hosts"><a class="anchor" href="#accessing-glusterfs-using-cinder-hosts"></a>Accessing GlusterFS using Cinder Hosts</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GlusterFS and Cinder integration provides a system for data storage that
enables users to access the same data, both as an object and as a file,
thus simplifying management and controlling storage costs.</p>
</div>
<div class="paragraph">
<p><em>GlusterFS</em> - GlusterFS is an open source, distributed file system
capable of scaling to several petabytes and handling thousands of
clients. GlusterFS clusters together storage building blocks over
Infiniband RDMA or TCP/IP interconnect, aggregating disk and memory
resources and managing data in a single global namespace. GlusterFS is
based on a stackable user space design and can deliver exceptional
performance for diverse workloads.</p>
</div>
<div class="paragraph">
<p><em>Cinder</em> - Cinder is the OpenStack service which is responsible for
handling persistent storage for virtual machines. This is persistent
block storage for the instances running in Nova. Snapshots can be taken
for backing up and data, either for restoring data, or to be used to
create new block storage volumes.</p>
</div>
<div class="paragraph">
<p>With Enterprise Linux 6, configuring OpenStack Grizzly to use GlusterFS
for its Cinder (block) storage is fairly simple.</p>
</div>
<div class="paragraph">
<p>These instructions have been tested with both GlusterFS 3.3 and
GlusterFS 3.4. Other releases may also work, but have not been tested.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>2. Prerequisites</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="glusterfs"><a class="anchor" href="#glusterfs"></a>GlusterFS</h3>
<div class="paragraph">
<p>For information on prerequsities and instructions for installing
GlusterFS, see <a href="http://www.gluster.org/community/documentation/index.php" class="bare">http://www.gluster.org/community/documentation/index.php</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cinder"><a class="anchor" href="#cinder"></a>Cinder</h3>
<div class="paragraph">
<p>For information on prerequsities and instructions for installing Cinder,
see <a href="http://docs.openstack.org/" class="bare">http://docs.openstack.org/</a>.</p>
</div>
<div class="paragraph">
<p>Before beginning, you must ensure there are <strong>no existing volumes</strong> in
Cinder. Use "cinder delete" to remove any, and "cinder list" to verify
that they are deleted. If you do not delete the existing cinder volumes,
it will cause errors later in the process, breaking your Cinder
installation.</p>
</div>
<div class="paragraph">
<p><strong>NOTE</strong> - Unlike other software, the "openstack-config" and "cinder"
commands generally require you to run them as a root user. Without prior
configuration, running them through sudo generally does not work. (This
can be changed, but is beyond the scope of this HOW-TO.)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-glusterfs-client-on-cinder-hosts"><a class="anchor" href="#installing-glusterfs-client-on-cinder-hosts"></a>3 Installing GlusterFS Client on Cinder hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On each Cinder host, install the GlusterFS client packages:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    $ sudo yum -y install glusterfs-fuse</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-cinder-to-add-glusterfs"><a class="anchor" href="#configuring-cinder-to-add-glusterfs"></a>4. Configuring Cinder to Add GlusterFS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On each Cinder host, run the following commands to add GlusterFS to the
Cinder configuration:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # openstack-config --set /etc/cinder/cinder.conf DEFAULT volume_driver cinder.volume.drivers.glusterfs.GlusterfsDriver
    # openstack-config --set /etc/cinder/cinder.conf DEFAULT glusterfs_shares_config /etc/cinder/shares.conf
    # openstack-config --set /etc/cinder/cinder.conf DEFAULT glusterfs_mount_point_base /var/lib/cinder/volumes</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-glusterfs-volume-list"><a class="anchor" href="#creating-glusterfs-volume-list"></a>5. Creating GlusterFS Volume List</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On each of the Cinder nodes, create a simple text file
<strong>/etc/cinder/shares.conf</strong>.</p>
</div>
<div class="paragraph">
<p>This file is a simple list of the GlusterFS volumes to be used, one per
line, using the following format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    GLUSTERHOST:VOLUME
    GLUSTERHOST:NEXTVOLUME
    GLUSTERHOST2:SOMEOTHERVOLUME</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    myglusterbox.example.org:myglustervol</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-firewall-for-glusterfs"><a class="anchor" href="#updating-firewall-for-glusterfs"></a>6. Updating Firewall for GlusterFS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You must update the firewall rules on each Cinder node to communicate
with the GlusterFS nodes.</p>
</div>
<div class="paragraph">
<p>The ports to open are explained in Step 3:</p>
</div>
<div class="paragraph">
<p><a href="http://gluster.org/community/documentation/index.php/Gluster_3.2:_Installing_GlusterFS_on_Red_Hat_Package_Manager_(RPM)_Distributions" class="bare">http://gluster.org/community/documentation/index.php/Gluster_3.2:_Installing_GlusterFS_on_Red_Hat_Package_Manager_(RPM)_Distributions</a></p>
</div>
<div class="paragraph">
<p>If you are using iptables as your firewall, these lines can be added
under <strong>:OUTPUT ACCEPT</strong> in the "*filter" section. You should probably
adjust them to suit your environment (eg. only accept connections from
your GlusterFS servers).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    -A INPUT -m state --state NEW -m tcp -p tcp --dport 111 -j ACCEPT
    -A INPUT -m state --state NEW -m tcp -p tcp --dport 24007 -j ACCEPT
    -A INPUT -m state --state NEW -m tcp -p tcp --dport 24008 -j ACCEPT
    -A INPUT -m state --state NEW -m tcp -p tcp --dport 24009 -j ACCEPT
    -A INPUT -m state --state NEW -m tcp -p tcp --dport 24010 -j ACCEPT
    -A INPUT -m state --state NEW -m tcp -p tcp --dport 24011 -j ACCEPT
    -A INPUT -m state --state NEW -m tcp -p tcp --dport 38465:38469 -j ACCEPT</pre>
</div>
</div>
<div class="paragraph">
<p>Restart the firewall service:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    $ sudo service iptables restart</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="restarting-cinder-services"><a class="anchor" href="#restarting-cinder-services"></a>7. Restarting Cinder Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configuration is complete and now you must restart the Cinder services
to make it active.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    $ for i in api scheduler volume; do sudo service openstack-cinder-${i} start; done</pre>
</div>
</div>
<div class="paragraph">
<p>Check the Cinder volume log to make sure that there are no errors:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    $ sudo tail -50 /var/log/cinder/volume.log</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="verify-glusterfs-integration-with-cinder"><a class="anchor" href="#verify-glusterfs-integration-with-cinder"></a>8. Verify GlusterFS Integration with Cinder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To verify if the installation and configuration is successful, create a
Cinder volume then check using GlusterFS.</p>
</div>
<div class="paragraph">
<p>Create a Cinder volume:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # cinder create --display_name myvol 10</pre>
</div>
</div>
<div class="paragraph">
<p>Volume creation takes a few seconds. Once created, run the following
command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # cinder list</pre>
</div>
</div>
<div class="paragraph">
<p>The volume should be in "available" status. Now, look for a new file in
the GlusterFS volume directory:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    $ sudo ls -lah /var/lib/cinder/volumes/XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX/</pre>
</div>
</div>
<div class="paragraph">
<p>(the XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX will be a number specific to your
installation)</p>
</div>
<div class="paragraph">
<p>A newly created file should be inside that directory which is the new
volume you just created. A new file will appear each time you create a
volume.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    $ sudo ls -lah /var/lib/cinder/volumes/29e55f0f3d56494ef1b1073ab927d425/
     total 4.0K
     drwxr-xr-x. 3 root   root     73 Apr  4 15:46 .
     drwxr-xr-x. 3 cinder cinder 4.0K Apr  3 09:31 ..
     -rw-rw-rw-. 1 root   root    10G Apr  4 15:46 volume-a4b97d2e-0f8e-45b2-9b94-b8fa36bd51b9</pre>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>