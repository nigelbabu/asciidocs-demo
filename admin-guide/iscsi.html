<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Gluster User Documentation Latest | Gluster Docs Project | iSCSI</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href="../../latest/_stylesheets/asciibinder.css" rel="stylesheet" />

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="../../latest/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="../../latest/_images/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body>
  <div class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="http://www.asciibinder.org/"><img alt="AsciiBinder" src="../../latest/_images/asciibinder-logo-horizontal.png"></a>
      </div>
    </div>
  </div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Home</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster User Documentation Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster Docs Project</a>
      </li>
      
      <li class="hidden-xs active">
        iSCSI
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-down"></span>Gluster Docs Project
      </a>
      <ul id="topicGroup0" class="collapse in list-unstyled">
            <li><a class="" href="../admin-guide/index.html">Index</a></li>
            <li><a class="" href="../admin-guide/access-control-lists.html">Access Control Lists</a></li>
            <li><a class="" href="../admin-guide/accessing-gluster-from-windows.html">Accessing Gluster from Windows</a></li>
            <li><a class="" href="../admin-guide/arbiter-volumes-and-quorum.html">Arbiter-volumes and Quorum</a></li>
            <li><a class="" href="../admin-guide/bareos.html">BareOS</a></li>
            <li><a class="" href="../admin-guide/brick-naming-conventions.html">Brick naming conventions</a></li>
            <li><a class="" href="../admin-guide/building-qemu-with-gfapi-for-debian-based-systems.html">Building QEMU with gfapi for Debian-based systems</a></li>
            <li><a class="" href="../admin-guide/cinder.html">Cinder</a></li>
            <li><a class="" href="../admin-guide/Console.html">Console</a></li>
            <li><a class="" href="../admin-guide/compiling-rpms.html">Compiling RPMs</a></li>
            <li><a class="" href="../admin-guide/coreutils.html">Coreutils</a></li>
            <li><a class="" href="../admin-guide/did-you-know.html">Did you know</a></li>
            <li><a class="" href="../admin-guide/directory-quota.html">Diectory Quota</a></li>
            <li><a class="" href="../admin-guide/distributed-geo-replication.html">Distributed Geo Replication</a></li>
            <li><a class="" href="../admin-guide/export-and-netgroup-authentication.html">Export and netgroup authentication</a></li>
            <li><a class="" href="../admin-guide/filter.html">Filter</a></li>
            <li><a class="" href="../admin-guide/geo-replication.html">Geo Replication</a></li>
            <li><a class="" href="../admin-guide/glossary.html">Glossary</a></li>
            <li><a class="" href="../admin-guide/gluster-on-zfs.html">Gluster on ZFS</a></li>
            <li><a class="" href="../admin-guide/Hadoop.html">Hadoop</a></li>
            <li><a class="" href="../admin-guide/Handling-of-users-with-many-groups.html">Handling of users with many groups</a></li>
            <li><a class="" href="../admin-guide/introduction.html">Introduction</a></li>
            <li><a class=" active" href="../admin-guide/iscsi.html">iSCSI</a></li>
            <li><a class="" href="../admin-guide/keystore-quickstart.html">Keystore Quickstart</a></li>
            <li><a class="" href="../admin-guide/linux-kernel-tuning.html">Linux Kernel Tuning</a></li>
            <li><a class="" href="../admin-guide/logging.html">Logging</a></li>
            <li><a class="" href="../admin-guide/managing-snapshots.html">Managing snapshots</a></li>
            <li><a class="" href="../admin-guide/managing-volumes.html">Managing Volumes</a></li>
            <li><a class="" href="../admin-guide/mandatory-locks.html">Mandatory Locks</a></li>
            <li><a class="" href="../admin-guide/monitoring-workload.html">Monitoring Workload</a></li>
            <li><a class="" href="../admin-guide/network-configuration-techniques.html">Network Configuration Techniques</a></li>
            <li><a class="" href="../admin-guide/nfs-ganesha-integration.html">NFS-Ganesha Integration</a></li>
            <li><a class="" href="../admin-guide/object-storage.html">Object storage</a></li>
            <li><a class="" href="../admin-guide/performance-testing.html">Performance Testing</a></li>
            <li><a class="" href="../admin-guide/Puppet.html">Puppet</a></li>
            <li><a class="" href="../admin-guide/rdma-transport.html">RDMA Transport</a></li>
            <li><a class="" href="../admin-guide/resolving-peer-rejected.html">Resolving Peer Rejected</a></li>
            <li><a class="" href="../admin-guide/setting-up-clients.html">Setting up Clients</a></li>
            <li><a class="" href="../admin-guide/setting-up-volumes.html">Setting up volumes</a></li>
            <li><a class="" href="../admin-guide/ssl.html">SSL</a></li>
            <li><a class="" href="../admin-guide/start-stop-daemon.html">Start Stop Daemon</a></li>
            <li><a class="" href="../admin-guide/storage-pools.html">Storage Pools</a></li>
            <li><a class="" href="../admin-guide/trash.html">Trash</a></li>
            <li><a class="" href="../admin-guide/troubleshooting.html">Troubleshooting</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Introduction</h2>
        </div>
        <div class="sect2">
<h3 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h3>
<div class="paragraph">
<p>iSCSI on Gluster can be set up using the Linux Target driver. This is a
user space daemon that accepts iSCSI (as well as iSER and FCoE.) It
interprets iSCSI CDBs and converts them into some other I/O operation,
according to user configuration. In our case, we can convert the CDBs
into file operations that run against a gluster file. The file
represents the LUN and the offset in the file the LBA.</p>
</div>
<div class="paragraph">
<p>A plug-in for the Linux target driver has been written to use the
libgfapi. It is part of the Linux target driver (bs_glfs.c). Using it,
the datapath skips FUSE. This document will be updated to describe how
to use it. You can see README.glfs in the Linux target driver&#8217;s
documentation subdirectory.</p>
</div>
<div class="paragraph">
<p>LIO is a replacement for the Linux Target Driver that is included in
RHEL7. A user-space plug-in mechanism for it is under development. Once
that piece of code exists a similar mechanism can be built for gluster
as was done for the Linux target driver.</p>
</div>
<div class="paragraph">
<p>Below is a cookbook to set it up using the Linux Target Driver on the
server. This has been tested on XEN and KVM instances within RHEL6,
RHEL7, and Fedora 19 instances. In this setup a single path leads to
gluster, which represents a performance bottleneck and single point of
failure. For HA and load balancing, it is possible to setup two or more
paths to different gluster servers using mpio; if the target name is
equivalent over each path, mpio will coalless both paths into a single
device.</p>
</div>
<div class="paragraph">
<p>For more information on iSCSI and the Linux target driver, see [1] and
[2].</p>
</div>
</div>
<div class="sect2">
<h3 id="setup"><a class="anchor" href="#setup"></a>Setup</h3>
<div class="paragraph">
<p>Mount gluster locally on your gluster server. Note you can also run it
on the gluster client. There are pros and cons to these configurations,
described <a href="#Running_the_target_on_the_gluster_client">below</a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # mount -t glusterfs 127.0.0.1:gserver /mnt</pre>
</div>
</div>
<div class="paragraph">
<p>Create a large file representing your block device within the gluster
fs. In this case, the lun is 2G. (You could also create a gluster "block
device" for this purpose, which would skip the file system).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # dd if=/dev/zero of=disk3 bs=2G count=25</pre>
</div>
</div>
<div class="paragraph">
<p>Create a target using the file as the backend storage.</p>
</div>
<div class="paragraph">
<p>If necessary, download the Linux SCSI target. Then start the service.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # yum install scsi-target-utils
    # service tgtd start</pre>
</div>
</div>
<div class="paragraph">
<p>You must give an iSCSI Qualified name (IQN), in the format :
iqn.yyyy-mm.reversed.domain.name:OptionalIdentifierText</p>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="paragraph">
<p>yyyy-mm represents the 4-digit year and 2-digit month the device was
started (for example: 2011-07)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # tgtadm --lld iscsi --op new --mode target --tid 1 -T iqn.20013-10.com.redhat</pre>
</div>
</div>
<div class="paragraph">
<p>You can look at the target:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # tgtadm --lld iscsi --op show --mode conn --tid 1

    Session: 11  Connection: 0     Initiator iqn.1994-05.com.redhat:cf75c8d4274d</pre>
</div>
</div>
<div class="paragraph">
<p>Next, add a logical unit to the target</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # tgtadm --lld iscsi --op new --mode logicalunit --tid 1 --lun 1 -b /mnt/disk3</pre>
</div>
</div>
<div class="paragraph">
<p>Allow any initiator to access the target.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # tgtadm --lld iscsi --op bind --mode target --tid 1 -I ALL</pre>
</div>
</div>
<div class="paragraph">
<p>Now it’s time to set up your client.</p>
</div>
<div class="paragraph">
<p>Discover your targets. Note in this example&#8217;s case, the target IP
address is 192.168.1.2</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # iscsiadm --mode discovery --type sendtargets --portal 192.168.1.2</pre>
</div>
</div>
<div class="paragraph">
<p>Login to your target session.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # iscsiadm --mode node --targetname iqn.2001-04.com.example:storage.disk1.amiens.sys1.xyz --portal 192.168.1.2:3260 --login</pre>
</div>
</div>
<div class="paragraph">
<p>You should have a new SCSI disk. You will see it created in
/var/log/messages. You will see it in lsblk.</p>
</div>
<div class="paragraph">
<p>You can send I/O to it:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # dd if=/dev/zero of=/dev/sda bs=4K count=100</pre>
</div>
</div>
<div class="paragraph">
<p>To tear down your iSCSI connection:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    # iscsiadm  -m node -T iqn.2001-04.com.redhat  -p 172.17.40.21 -u</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-iscsi-target-on-the-gluster-client"><a class="anchor" href="#running-the-iscsi-target-on-the-gluster-client"></a>Running the iSCSI target on the gluster client</h3>
<div class="paragraph">
<p>You can run the Linux target daemon on the gluster client. The
advantages to this setup is the client could run gluster and enjoy all
of gluster&#8217;s benefits. For example, gluster could "fan out" I/O to
different gluster servers. The downside would be that the client would
need to load and configure gluster. It is better to run gluster on the
client if it is possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="references"><a class="anchor" href="#references"></a>References</h3>
<div class="paragraph">
<p><a href="http://www.linuxjournal.com/content/creating-software-backed-iscsi-targets-red-hat-enterprise-linux-6" class="bare">http://www.linuxjournal.com/content/creating-software-backed-iscsi-targets-red-hat-enterprise-linux-6</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.cyberciti.biz/tips/howto-setup-linux-iscsi-target-sanwith-tgt.html" class="bare">http://www.cyberciti.biz/tips/howto-setup-linux-iscsi-target-sanwith-tgt.html</a></p>
</div>
</div>
      </div>
    </div>
  </div>
   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>