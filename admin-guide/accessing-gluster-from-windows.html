<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Gluster User Documentation Latest | Gluster Docs Project | Accessing Gluster from Windows</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href="../../latest/_stylesheets/asciibinder.css" rel="stylesheet" />

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="../../latest/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="../../latest/_images/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body>
  <div class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="http://www.asciibinder.org/"><img alt="AsciiBinder" src="../../latest/_images/asciibinder-logo-horizontal.png"></a>
      </div>
    </div>
  </div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Home</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster User Documentation Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster Docs Project</a>
      </li>
      
      <li class="hidden-xs active">
        Accessing Gluster from Windows
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-down"></span>Gluster Docs Project
      </a>
      <ul id="topicGroup0" class="collapse in list-unstyled">
            <li><a class="" href="../admin-guide/index.html">Index</a></li>
            <li><a class="" href="../admin-guide/access-control-lists.html">Access Control Lists</a></li>
            <li><a class=" active" href="../admin-guide/accessing-gluster-from-windows.html">Accessing Gluster from Windows</a></li>
            <li><a class="" href="../admin-guide/arbiter-volumes-and-quorum.html">Arbiter-volumes and Quorum</a></li>
            <li><a class="" href="../admin-guide/bareos.html">BareOS</a></li>
            <li><a class="" href="../admin-guide/brick-naming-conventions.html">Brick naming conventions</a></li>
            <li><a class="" href="../admin-guide/building-qemu-with-gfapi-for-debian-based-systems.html">Building QEMU with gfapi for Debian-based systems</a></li>
            <li><a class="" href="../admin-guide/cinder.html">Cinder</a></li>
            <li><a class="" href="../admin-guide/Console.html">Console</a></li>
            <li><a class="" href="../admin-guide/compiling-rpms.html">Compiling RPMs</a></li>
            <li><a class="" href="../admin-guide/coreutils.html">Coreutils</a></li>
            <li><a class="" href="../admin-guide/did-you-know.html">Did you know</a></li>
            <li><a class="" href="../admin-guide/directory-quota.html">Diectory Quota</a></li>
            <li><a class="" href="../admin-guide/distributed-geo-replication.html">Distributed Geo Replication</a></li>
            <li><a class="" href="../admin-guide/export-and-netgroup-authentication.html">Export and netgroup authentication</a></li>
            <li><a class="" href="../admin-guide/filter.html">Filter</a></li>
            <li><a class="" href="../admin-guide/geo-replication.html">Geo Replication</a></li>
            <li><a class="" href="../admin-guide/glossary.html">Glossary</a></li>
            <li><a class="" href="../admin-guide/gluster-on-zfs.html">Gluster on ZFS</a></li>
            <li><a class="" href="../admin-guide/Hadoop.html">Hadoop</a></li>
            <li><a class="" href="../admin-guide/Handling-of-users-with-many-groups.html">Handling of users with many groups</a></li>
            <li><a class="" href="../admin-guide/introduction.html">Introduction</a></li>
            <li><a class="" href="../admin-guide/iscsi.html">iSCSI</a></li>
            <li><a class="" href="../admin-guide/keystore-quickstart.html">Keystore Quickstart</a></li>
            <li><a class="" href="../admin-guide/linux-kernel-tuning.html">Linux Kernel Tuning</a></li>
            <li><a class="" href="../admin-guide/logging.html">Logging</a></li>
            <li><a class="" href="../admin-guide/managing-snapshots.html">Managing snapshots</a></li>
            <li><a class="" href="../admin-guide/managing-volumes.html">Managing Volumes</a></li>
            <li><a class="" href="../admin-guide/mandatory-locks.html">Mandatory Locks</a></li>
            <li><a class="" href="../admin-guide/monitoring-workload.html">Monitoring Workload</a></li>
            <li><a class="" href="../admin-guide/network-configuration-techniques.html">Network Configuration Techniques</a></li>
            <li><a class="" href="../admin-guide/nfs-ganesha-integration.html">NFS-Ganesha Integration</a></li>
            <li><a class="" href="../admin-guide/object-storage.html">Object storage</a></li>
            <li><a class="" href="../admin-guide/performance-testing.html">Performance Testing</a></li>
            <li><a class="" href="../admin-guide/Puppet.html">Puppet</a></li>
            <li><a class="" href="../admin-guide/rdma-transport.html">RDMA Transport</a></li>
            <li><a class="" href="../admin-guide/resolving-peer-rejected.html">Resolving Peer Rejected</a></li>
            <li><a class="" href="../admin-guide/setting-up-clients.html">Setting up Clients</a></li>
            <li><a class="" href="../admin-guide/setting-up-volumes.html">Setting up volumes</a></li>
            <li><a class="" href="../admin-guide/ssl.html">SSL</a></li>
            <li><a class="" href="../admin-guide/start-stop-daemon.html">Start Stop Daemon</a></li>
            <li><a class="" href="../admin-guide/storage-pools.html">Storage Pools</a></li>
            <li><a class="" href="../admin-guide/trash.html">Trash</a></li>
            <li><a class="" href="../admin-guide/troubleshooting.html">Troubleshooting</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Accessing Gluster volume via SMB Protocol</h2>
        </div>
        <div class="sect1">
<h2 id="accessing-gluster-volume-via-smb-protocol"><a class="anchor" href="#accessing-gluster-volume-via-smb-protocol"></a>Accessing Gluster volume via SMB Protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Layered product Samba is used to export the Gluster volume and ctdb for
providing the high availability Samba. Here are the steps to configure
Highly Available Samba cluster to export Gluster volume.</p>
</div>
<div class="paragraph">
<p><em>Note: These configuration steps are applicable to Samba version =
4.1.* and Gluster Version &gt;= 3.7.* ctdb &gt;= 2.5</em>**</p>
</div>
<div id="step-1-choose-the-servers-that-will-export-the-gluster-volume." class="paragraph">
<p>Step 1: Choose the servers that will export the Gluster volume.</p>
</div>
<div class="paragraph">
<p>The servers may/may not be part of the trusted storage pool. Preferable
number of servers is &#8656;4. Install Samba and ctdb packages on these
servers.</p>
</div>
<div id="step-2-enabledisable-the-auto-export-of-gluster-volume-via-smb" class="paragraph">
<p>Step 2: Enable/Disable the auto export of Gluster volume via SMB</p>
</div>
<div class="paragraph">
<p><code># gluster volume set VOLNAME user.smb disable/enable</code></p>
</div>
<div id="step-3-setup-the-ctdb-cluster" class="paragraph">
<p>Step 3: Setup the CTDB Cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a ctdb meta volume with replica N, N being the number of the
servers that are used as Samba servers. This volume will host only a
zero byte lock file, hence choose the minimal sized bricks. To create
the n replica volume run the following command:<br>
<code># gluster volume create &lt;volname&gt; replica n &lt;ipaddr/host name&gt;:/&lt;brick_patch&gt;&#8230;&#8203;. N times</code></p>
</li>
<li>
<p>In the following files, replace "all" in the statement "META=all" to
the newly created volume name.</p>
<div class="literalblock">
<div class="content">
<pre>/var/lib/glusterd/hooks/1/start/post/S29CTDBsetup.sh
/var/lib/glusterd/hooks/1/stop/pre/S29CTDB-teardown.sh</pre>
</div>
</div>
</li>
<li>
<p>Start the ctdb volume<br>
<code># gluster vol start &lt;volname&gt;</code></p>
</li>
<li>
<p>Verify the following:</p>
<div class="ulist">
<ul>
<li>
<p>If the following lines are added in smb.conf file in all the nodes
running samba/ctdb:</p>
<div class="literalblock">
<div class="content">
<pre>clustering = yes
idmap backend = tdb2</pre>
</div>
</div>
</li>
<li>
<p>If the ctdb volume is mounted at /gluster/lock on all the nodes that
runs ctdb/samba</p>
</li>
<li>
<p>If the mount entry for ctdb volume is added in /etc/fstab</p>
</li>
<li>
<p>If file /etc/sysconfig/ctdb exists on all the nodes that runs
ctdb/samba</p>
</li>
</ul>
</div>
</li>
<li>
<p>Create /etc/ctdb/nodes files on all the nodes that runs ctdb/samba,
and add the IPs of all these nodes in the file.<br>
Eg:
<code>#cat /etc/ctdb/nodes    10.16.157.0    10.16.157.3    10.16.157.6    10.16.157.8</code>
The IPs listed here are the private IPs of Samba/ctdb servers, which
should be a private non-routable subnet and are only used for internal
cluster traffic. For more details refer to the ctdb man page.</p>
</li>
<li>
<p>Create /etc/ctdb/public_addresses files on all the nodes that runs
ctdb/samba, and add the virtual IPs in the following format:<br>
<code>&lt;virtual IP&gt;&lt;routing prefix&gt; &lt;node interface&gt;</code><br>
<code>Eg:    #cat /etc/ctdb/public_addresses    192.168.1.20/24 eth0    192.168.1.21/24 eth0</code></p>
</li>
</ol>
</div>
<div id="step-4-suggested-settings-before-exporting-the-volume" class="paragraph">
<p>Step 4: Suggested settings before exporting the volume</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Permit insecure ports for clients to brick and clients to glusterd
connections<br>
<code># gluster volume set VOLNAME server.allow-insecure</code></p>
<div class="paragraph">
<p>Also edit /etc/glusterfs/glusterd.vol on all nodes in trusted storage
pool and add the following setting:<br>
<code>option rpc-auth-allow-insecure on</code></p>
</div>
<div class="paragraph">
<p>Restart glusterd service on all nodes:<br>
<code>systemctl restart glusterd</code></p>
</div>
</li>
<li>
<p>Disable metadata caching in gluster client:<br>
<code>gluster volume set VOLNAME stat-prefetch off</code></p>
</li>
<li>
<p>To ensure lock and IO coherency:<br>
<code>#gluster volume set VOLNAME storage.batch-fsync-delay-usec 0</code></p>
</li>
<li>
<p>If using Samba 4.X version add the following line in smb.conf for
all gluster volume or in the global section<br>
<code>kernel share modes = no    kernel oplocks = no    map archive = no    map hidden = no    map read only = no    map system = no    store dos attributes = yes</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note: Setting 'store dos attributes = no' is recommended if
archive/hidden/read only dos attributes are not used. This can give
better performance.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If selinux is enabled and enforcing, try the following command if
ctdb fails.<br>
<code># setsebool -P use_fusefs_home_dirs 1    # setsebool -P samba_load_libgfapi 1</code></p>
</li>
</ol>
</div>
<div id="step-5-mount-the-volume-using-smb" class="paragraph">
<p>Step 5: Mount the volume using SMB</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If no Active directory setup add the user on all the samba server
and set the password<br>
<code># adduser USERNAME    # smbpasswd -a USERNAME</code></p>
</li>
<li>
<p>Start the ctdb, smb and other related services:<br>
<code># systemctl re/start ctdb    # ctdb status    # ctdb ip    # ctdb ping -n all</code></p>
</li>
<li>
<p>To verify if the volume exported by samba can be accessed by a
user:<br>
<code># smbclient //&lt;hostname&gt;/gluster-&lt;volname&gt; -U &lt;username&gt;%&lt;password&gt;</code></p>
</li>
<li>
<p>To mount on a linux system:<br>
<code># mount -t cifs -o user=&lt;username&gt;,pass=&lt;password&gt; //&lt;Virtual IP&gt;/gluster-&lt;volname&gt; /&lt;mountpoint&gt;</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To mount on Windows system:<br>
<code>&gt;net use &lt;device:&gt; \\&lt;Virtual IP&gt;\gluster-&lt;volname&gt;</code><br>
OR<br>
<code>\\&lt;Virtual IP&gt;\gluster-&lt;volname&gt;</code> from windows explorer.</p>
</div>
</div>
</div>
      </div>
    </div>
  </div>
   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>