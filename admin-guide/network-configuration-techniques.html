<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Gluster User Documentation Latest | Gluster Docs Project | Network Configuration Techniques</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href="../../latest/_stylesheets/asciibinder.css" rel="stylesheet" />

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="../../latest/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="../../latest/_images/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body>
  <div class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="http://www.asciibinder.org/"><img alt="AsciiBinder" src="../../latest/_images/asciibinder-logo-horizontal.png"></a>
      </div>
    </div>
  </div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Home</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster User Documentation Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster Docs Project</a>
      </li>
      
      <li class="hidden-xs active">
        Network Configuration Techniques
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-down"></span>Gluster Docs Project
      </a>
      <ul id="topicGroup0" class="collapse in list-unstyled">
            <li><a class="" href="../admin-guide/index.html">Index</a></li>
            <li><a class="" href="../admin-guide/access-control-lists.html">Access Control Lists</a></li>
            <li><a class="" href="../admin-guide/accessing-gluster-from-windows.html">Accessing Gluster from Windows</a></li>
            <li><a class="" href="../admin-guide/arbiter-volumes-and-quorum.html">Arbiter-volumes and Quorum</a></li>
            <li><a class="" href="../admin-guide/bareos.html">BareOS</a></li>
            <li><a class="" href="../admin-guide/brick-naming-conventions.html">Brick naming conventions</a></li>
            <li><a class="" href="../admin-guide/building-qemu-with-gfapi-for-debian-based-systems.html">Building QEMU with gfapi for Debian-based systems</a></li>
            <li><a class="" href="../admin-guide/cinder.html">Cinder</a></li>
            <li><a class="" href="../admin-guide/Console.html">Console</a></li>
            <li><a class="" href="../admin-guide/compiling-rpms.html">Compiling RPMs</a></li>
            <li><a class="" href="../admin-guide/coreutils.html">Coreutils</a></li>
            <li><a class="" href="../admin-guide/did-you-know.html">Did you know</a></li>
            <li><a class="" href="../admin-guide/directory-quota.html">Diectory Quota</a></li>
            <li><a class="" href="../admin-guide/distributed-geo-replication.html">Distributed Geo Replication</a></li>
            <li><a class="" href="../admin-guide/export-and-netgroup-authentication.html">Export and netgroup authentication</a></li>
            <li><a class="" href="../admin-guide/filter.html">Filter</a></li>
            <li><a class="" href="../admin-guide/geo-replication.html">Geo Replication</a></li>
            <li><a class="" href="../admin-guide/glossary.html">Glossary</a></li>
            <li><a class="" href="../admin-guide/gluster-on-zfs.html">Gluster on ZFS</a></li>
            <li><a class="" href="../admin-guide/Hadoop.html">Hadoop</a></li>
            <li><a class="" href="../admin-guide/Handling-of-users-with-many-groups.html">Handling of users with many groups</a></li>
            <li><a class="" href="../admin-guide/introduction.html">Introduction</a></li>
            <li><a class="" href="../admin-guide/iscsi.html">iSCSI</a></li>
            <li><a class="" href="../admin-guide/keystore-quickstart.html">Keystore Quickstart</a></li>
            <li><a class="" href="../admin-guide/linux-kernel-tuning.html">Linux Kernel Tuning</a></li>
            <li><a class="" href="../admin-guide/logging.html">Logging</a></li>
            <li><a class="" href="../admin-guide/managing-snapshots.html">Managing snapshots</a></li>
            <li><a class="" href="../admin-guide/managing-volumes.html">Managing Volumes</a></li>
            <li><a class="" href="../admin-guide/mandatory-locks.html">Mandatory Locks</a></li>
            <li><a class="" href="../admin-guide/monitoring-workload.html">Monitoring Workload</a></li>
            <li><a class=" active" href="../admin-guide/network-configuration-techniques.html">Network Configuration Techniques</a></li>
            <li><a class="" href="../admin-guide/nfs-ganesha-integration.html">NFS-Ganesha Integration</a></li>
            <li><a class="" href="../admin-guide/object-storage.html">Object storage</a></li>
            <li><a class="" href="../admin-guide/performance-testing.html">Performance Testing</a></li>
            <li><a class="" href="../admin-guide/Puppet.html">Puppet</a></li>
            <li><a class="" href="../admin-guide/rdma-transport.html">RDMA Transport</a></li>
            <li><a class="" href="../admin-guide/resolving-peer-rejected.html">Resolving Peer Rejected</a></li>
            <li><a class="" href="../admin-guide/setting-up-clients.html">Setting up Clients</a></li>
            <li><a class="" href="../admin-guide/setting-up-volumes.html">Setting up volumes</a></li>
            <li><a class="" href="../admin-guide/ssl.html">SSL</a></li>
            <li><a class="" href="../admin-guide/start-stop-daemon.html">Start Stop Daemon</a></li>
            <li><a class="" href="../admin-guide/storage-pools.html">Storage Pools</a></li>
            <li><a class="" href="../admin-guide/trash.html">Trash</a></li>
            <li><a class="" href="../admin-guide/troubleshooting.html">Troubleshooting</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Bonding best practices</h2>
        </div>
        <div class="sect4">
<h5 id="bonding-best-practices"><a class="anchor" href="#bonding-best-practices"></a>Bonding best practices</h5>
<div class="paragraph">
<p>Bonded network interfaces incorporate multiple physical interfaces into
a single logical bonded interface, with a single IP addr. An N-way
bonded interface can survive loss of N-1 physical interfaces, and
performance can be improved in some cases.</p>
</div>
<div id="when-to-bond" class="paragraph">
<p>when to bond</p>
</div>
<div class="ulist">
<ul>
<li>
<p>need high availability for network link</p>
</li>
<li>
<p>workload: sequential access to large files (most time spent
reading/writing)</p>
</li>
<li>
<p>network throughput limit of client/server &lt;&lt; storage throughput limit</p>
<div class="ulist">
<ul>
<li>
<p>1 GbE (almost always)</p>
</li>
<li>
<p>10-Gbps links or faster&#8201;&#8212;&#8201;for writes, replication doubles the load
on the network and replicas are usually on different peers to which the
client can transmit in parallel.</p>
</li>
</ul>
</div>
</li>
<li>
<p>LIMITATION: bonding mode 6 doesn&#8217;t improve throughput if network peers
are not on the same VLAN.</p>
</li>
</ul>
</div>
<div id="how-to-configure" class="paragraph">
<p>how to configure</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.linuxquestions.org/linux/answers/Networking/Linux_bonding_howto_0">bonding-howto</a></p>
</li>
<li>
<p>best bonding mode for Gluster client is mode 6 (balance-alb), this
allows client to transmit writes in parallel on separate NICs much of
the time. A peak throughput of 750 MB/s on writes from a single client
was observed with bonding mode 6 on 2 10-GbE NICs with jumbo frames.
That&#8217;s 1.5 GB/s of network traffic.</p>
</li>
<li>
<p>another way to balance both transmit and receive traffic is bonding
mode 4 (802.3ad) but this requires switch configuration (trunking
commands)</p>
</li>
<li>
<p>still another way to load balance is bonding mode 2 (balance-xor) with
option "xmit_hash_policy=layer3+4". The bonding modes 6 and 2 will not
improve single-connection throughput, but improve aggregate throughput
across all connections.</p>
</li>
</ul>
</div>
<div id="jumbo-frames" class="paragraph">
<p>jumbo frames</p>
</div>
<div class="paragraph">
<p>Jumbo frames are Ethernet (or Infiniband) frames with size greater than
the default of 1500 bytes (Infiniband default is around 2000 bytes).
Increasing frame size reduces load on operating system and hardware,
which must process interrupts and protocol messages per frame.</p>
</div>
<div id="when-to-configure" class="paragraph">
<p>when to configure</p>
</div>
<div class="ulist">
<ul>
<li>
<p>any network faster than 1-GbE</p>
</li>
<li>
<p>workload is sequential large-file reads/writes</p>
</li>
<li>
<p>LIMITATION: requires all network switches in VLAN must be configured
to handle jumbo frames, do not configure otherwise.</p>
</li>
</ul>
</div>
<div id="how-to-configure-1" class="paragraph">
<p>how to configure</p>
</div>
<div class="ulist">
<ul>
<li>
<p>edit network interface file at
/etc/sysconfig/network-scripts/ifcfg-your-interface</p>
</li>
<li>
<p>Ethernet (on ixgbe driver): add "MTU=9000" (MTU means "maximum
transfer unit") record to network interface file</p>
</li>
<li>
<p>Infiniband (on mlx4 driver): add "CONNECTED_MODE=yes" and "MTU=65520"
records to network interface file</p>
</li>
<li>
<p>ifdown your-interface; ifup your-interface</p>
</li>
<li>
<p>test with "ping -s 16384 other-host-on-VLAN"</p>
</li>
<li>
<p>switch requires max frame size larger than MTU because of protocol
headers, usually 9216 bytes</p>
</li>
</ul>
</div>
<div id="configuring-a-backend-network-for-storage" class="paragraph">
<p>configuring a backend network for storage</p>
</div>
<div class="paragraph">
<p>This method lets you add network capacity for multi-protocol sites by
segregating traffic for different protocols on different network
interfaces. This method can lower latency and improve throughput. For
example, this method can keep self-heal and rebalancing traffic from
competing with non-Gluster client traffic for a network interface, and
will better support multi-stream I/O.</p>
</div>
<div id="when-to-configure-1" class="paragraph">
<p>when to configure</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for non-Gluster services such as NFS, Swift (REST), CIFS being
provided on Gluster servers. It will not help Gluster clients (external
nodes with Gluster mountpoints on them).</p>
</li>
<li>
<p>network port is over-utilized.</p>
</li>
</ul>
</div>
<div id="how-to-configure-2" class="paragraph">
<p>how to configure</p>
</div>
<div class="ulist">
<ul>
<li>
<p>most network cards have multiple ports on them&#8201;&#8212;&#8201;make port 1 the
non-Gluster port and port 2 the Gluster port.</p>
</li>
<li>
<p>separate Gluster ports onto a separate VLAN from non-Gluster ports, to
simplify configuration.</p>
</li>
</ul>
</div>
</div>
      </div>
    </div>
  </div>
   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>