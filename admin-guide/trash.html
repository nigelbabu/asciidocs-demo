<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Gluster User Documentation Latest | Gluster Docs Project | Trash</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href="../../latest/_stylesheets/asciibinder.css" rel="stylesheet" />

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="../../latest/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="../../latest/_images/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body>
  <div class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="http://www.asciibinder.org/"><img alt="AsciiBinder" src="../../latest/_images/asciibinder-logo-horizontal.png"></a>
      </div>
    </div>
  </div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Home</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster User Documentation Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin-guide/index.html">Gluster Docs Project</a>
      </li>
      
      <li class="hidden-xs active">
        Trash
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-down"></span>Gluster Docs Project
      </a>
      <ul id="topicGroup0" class="collapse in list-unstyled">
            <li><a class="" href="../admin-guide/index.html">Index</a></li>
            <li><a class="" href="../admin-guide/access-control-lists.html">Access Control Lists</a></li>
            <li><a class="" href="../admin-guide/accessing-gluster-from-windows.html">Accessing Gluster from Windows</a></li>
            <li><a class="" href="../admin-guide/arbiter-volumes-and-quorum.html">Arbiter-volumes and Quorum</a></li>
            <li><a class="" href="../admin-guide/bareos.html">BareOS</a></li>
            <li><a class="" href="../admin-guide/brick-naming-conventions.html">Brick naming conventions</a></li>
            <li><a class="" href="../admin-guide/building-qemu-with-gfapi-for-debian-based-systems.html">Building QEMU with gfapi for Debian-based systems</a></li>
            <li><a class="" href="../admin-guide/cinder.html">Cinder</a></li>
            <li><a class="" href="../admin-guide/Console.html">Console</a></li>
            <li><a class="" href="../admin-guide/compiling-rpms.html">Compiling RPMs</a></li>
            <li><a class="" href="../admin-guide/coreutils.html">Coreutils</a></li>
            <li><a class="" href="../admin-guide/did-you-know.html">Did you know</a></li>
            <li><a class="" href="../admin-guide/directory-quota.html">Diectory Quota</a></li>
            <li><a class="" href="../admin-guide/distributed-geo-replication.html">Distributed Geo Replication</a></li>
            <li><a class="" href="../admin-guide/export-and-netgroup-authentication.html">Export and netgroup authentication</a></li>
            <li><a class="" href="../admin-guide/filter.html">Filter</a></li>
            <li><a class="" href="../admin-guide/geo-replication.html">Geo Replication</a></li>
            <li><a class="" href="../admin-guide/glossary.html">Glossary</a></li>
            <li><a class="" href="../admin-guide/gluster-on-zfs.html">Gluster on ZFS</a></li>
            <li><a class="" href="../admin-guide/Hadoop.html">Hadoop</a></li>
            <li><a class="" href="../admin-guide/Handling-of-users-with-many-groups.html">Handling of users with many groups</a></li>
            <li><a class="" href="../admin-guide/introduction.html">Introduction</a></li>
            <li><a class="" href="../admin-guide/iscsi.html">iSCSI</a></li>
            <li><a class="" href="../admin-guide/keystore-quickstart.html">Keystore Quickstart</a></li>
            <li><a class="" href="../admin-guide/linux-kernel-tuning.html">Linux Kernel Tuning</a></li>
            <li><a class="" href="../admin-guide/logging.html">Logging</a></li>
            <li><a class="" href="../admin-guide/managing-snapshots.html">Managing snapshots</a></li>
            <li><a class="" href="../admin-guide/managing-volumes.html">Managing Volumes</a></li>
            <li><a class="" href="../admin-guide/mandatory-locks.html">Mandatory Locks</a></li>
            <li><a class="" href="../admin-guide/monitoring-workload.html">Monitoring Workload</a></li>
            <li><a class="" href="../admin-guide/network-configuration-techniques.html">Network Configuration Techniques</a></li>
            <li><a class="" href="../admin-guide/nfs-ganesha-integration.html">NFS-Ganesha Integration</a></li>
            <li><a class="" href="../admin-guide/object-storage.html">Object storage</a></li>
            <li><a class="" href="../admin-guide/performance-testing.html">Performance Testing</a></li>
            <li><a class="" href="../admin-guide/Puppet.html">Puppet</a></li>
            <li><a class="" href="../admin-guide/rdma-transport.html">RDMA Transport</a></li>
            <li><a class="" href="../admin-guide/resolving-peer-rejected.html">Resolving Peer Rejected</a></li>
            <li><a class="" href="../admin-guide/setting-up-clients.html">Setting up Clients</a></li>
            <li><a class="" href="../admin-guide/setting-up-volumes.html">Setting up volumes</a></li>
            <li><a class="" href="../admin-guide/ssl.html">SSL</a></li>
            <li><a class="" href="../admin-guide/start-stop-daemon.html">Start Stop Daemon</a></li>
            <li><a class="" href="../admin-guide/storage-pools.html">Storage Pools</a></li>
            <li><a class=" active" href="../admin-guide/trash.html">Trash</a></li>
            <li><a class="" href="../admin-guide/troubleshooting.html">Troubleshooting</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Trash Translator</h2>
        </div>
        <div class="sect1">
<h2 id="trash-translator"><a class="anchor" href="#trash-translator"></a>Trash Translator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Trash translator will allow users to access deleted or truncated files.
Every brick will maintain a hidden .trashcan directory , which will be
used to store the files deleted or truncated from the respective brick
.The aggreagate of all those .trashcan directory can be accesed from the
mount point. In order to avoid name collisions , a time stamp is
appended to the original file name while it is being moved to trash
directory.</p>
</div>
<div class="sect2">
<h3 id="implications-and-usage"><a class="anchor" href="#implications-and-usage"></a>Implications and Usage</h3>
<div class="paragraph">
<p>Apart from the primary use-case of accessing files deleted or truncated
by user , the trash translator can be helpful for internal operations
such as self-heal and rebalance. During self-heal and rebalance it is
possible to lose crucial data. In those circumstances the trash
translator can assist in recovery of the lost data. The trash translator
is designed to intercept unlink, truncate and ftruncate fops, store a
copy of the current file in the trash directory, and then perform the
fop on the original file. For the internal operations , the files are
stored under 'internal_op' folder inside trash directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="volume-options"><a class="anchor" href="#volume-options"></a>Volume Options</h3>
<div class="ulist">
<ul>
<li>
<p><strong><em>gluster volume set &lt;VOLNAME&gt; features.trash &lt;on / off&gt;</em></strong></p>
<div class="paragraph">
<p>This command can be used to enable trash translator in a volume. If set
to on, trash directory will be created in every brick inside the volume
during volume start command. By default translator is loaded during
volume start but remains non-functional. Disabling trash with the help
of this option will not remove the trash directory or even its contents
from the volume.</p>
</div>
</li>
<li>
<p><strong><em>gluster volume set &lt;VOLNAME&gt; features.trash-dir &lt;name&gt;</em></strong></p>
<div class="paragraph">
<p>This command is used to reconfigure the trash directory to a user
specified name. The argument is a valid directory name. Directory will
be created inside every brick under this name. If not specified by the
user, the trash translator will create the trash directory with the
default name “.trashcan”. This can be used only when trash-translator is
on.</p>
</div>
</li>
<li>
<p><strong><em>gluster volume set &lt;VOLNAME&gt; features.trash-max-filesize &lt;size&gt;</em></strong></p>
<div class="paragraph">
<p>This command can be used to filter files entering trash directory based
on their size. Files above trash_max_filesize are deleted/truncated
directly. Value for size may be followed by mutliplicative suffixes as
KB(=1024 bytes), MB(=1024*1024 bytes) and GB(=1024*1024*1024 bytes).
Default size is set to 5MB. Considering the fact that trash directory is
consuming the glusterfs volume space, trash feature is implemented to
function in such a way that it directly deletes/truncates files with
size &gt; 1GB even if this option is set to some value greater than 1GB.</p>
</div>
</li>
<li>
<p><strong><em>gluster volume set &lt;VOLNAME&gt; features.trash-eliminate-path &lt;path1&gt; [
, &lt;path2&gt; , . . . ]</em></strong></p>
<div class="paragraph">
<p>This command can be used to set the eliminate pattern for the trash
translator. Files residing under this pattern will not be moved to trash
directory during deletion/truncation. Path must be a valid one present
in volume.</p>
</div>
</li>
<li>
<p><strong><em>gluster volume set &lt;VOLNAME&gt; features.trash-internal-op &lt;on / off&gt;</em></strong></p>
<div class="paragraph">
<p>This command can be used to enable trash for internal operations like
self-heal and re-balance. By default set to off.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sample-usage"><a class="anchor" href="#sample-usage"></a>Sample usage</h3>
<div class="paragraph">
<p>Following steps give illustrates a simple scenario of deletion of file
from directory</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a simple distribute volume and start it.</p>
<div class="literalblock">
<div class="content">
<pre># gluster volume create test rhs:/home/brick
# gluster volume start test</pre>
</div>
</div>
</li>
<li>
<p>Enable trash translator</p>
<div class="literalblock">
<div class="content">
<pre># gluster volume set test features.trash on</pre>
</div>
</div>
</li>
<li>
<p>Mount glusterfs volume via native client as follows.</p>
<div class="literalblock">
<div class="content">
<pre># mount -t glusterfs  rhs:test /mnt</pre>
</div>
</div>
</li>
<li>
<p>Create a directory and file in the mount.</p>
<div class="literalblock">
<div class="content">
<pre># mkdir mnt/dir
# echo abc &gt; mnt/dir/file</pre>
</div>
</div>
</li>
<li>
<p>Delete the file from the mount.</p>
<div class="literalblock">
<div class="content">
<pre># rm mnt/dir/file -rf</pre>
</div>
</div>
</li>
<li>
<p>Checkout inside the trash directory.</p>
<div class="literalblock">
<div class="content">
<pre># ls mnt/.trashcan</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>We can find the deleted file inside the trash directory with timestamp
appending on its filename.</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    [root@rh-host ~]# mount -t glusterfs rh-host:/test /mnt/test
    [root@rh-host ~]# mkdir /mnt/test/abc
    [root@rh-host ~]# touch /mnt/test/abc/file
    [root@rh-host ~]# rm /mnt/test/abc/file
    remove regular empty file ‘/mnt/test/abc/file’? y
    [root@rh-host ~]# ls /mnt/test/abc
    [root@rh-host ~]#
    [root@rh-host ~]# ls /mnt/test/.trashcan/abc/
    file2014-08-21_123400</pre>
</div>
</div>
<div id="points-to-be-remembered" class="paragraph">
<p>Points to be remembered</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As soon as the volume is started, trash directory will be created
inside the volume and will be visible through mount. Disabling trash
will not have any impact on its visibilty from the mount.</p>
</li>
<li>
<p>Eventhough deletion of trash-directory is not permitted, currently
residing trash contents will be removed on issuing delete on it and only
an empty trash-directory exists.</p>
</li>
</ul>
</div>
<div id="known-issue" class="paragraph">
<p>Known issue</p>
</div>
<div class="paragraph">
<p>Since trash translator resides on the server side higher translator like
AFR, DHT are unaware of rename and truncate operations being done by
this translator which eventually moves the files to trash directory.
Unless and until a complete-path-based lookup comes on trashed files,
those may not be visible from the mount.</p>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>